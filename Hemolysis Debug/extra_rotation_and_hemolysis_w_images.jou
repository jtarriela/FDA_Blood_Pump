/file/read-case-data "C5_SBES_19M_T-1-24000.cas.h5"


;########## Compile new udf with extra uds CY_Hemolysis_MOD_UDF.c
/define/user-defined/compiled-functions compile libudf yes "CY_Hemolysis_MOD_UDF.c" "" "udf.h" ""
/define/user-defined/compiled-functions load libudf
/define/user-defined/function-hooks/adjust "BloodDamage::libudf" ""
/define/user-defined/user-defined-scalars 4 no no yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default"
/define/materials/change-create blood blood no no no no no no yes defined-per-uds 0 constant 0 1 constant 0 2 constant 0 3 constant 0 -1 no
;##########   Cell Zone Def Rotor Rotation & Source Terms ##########;
/define/boundary-conditions/fluid inflow no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no no no 0 no 0 no 0 no 0 no 0 no 0 no 1 no no no no no
/define/boundary-conditions/fluid rotor no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no yes -1 no "rotor_speed" no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 1 "none" no no no no no
/define/boundary-conditions/fluid volute no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no no no 0 no 0 no 0 no 0 no 0 no 0 no 0 no no no no no

;########### set new convergence

;########### flow equations

/solve/set/equations flow yes
/solve/set/equations kw yes
/solve/set/equations uds-0 yes
/solve/set/equations uds-1 yes
/solve/set/equations uds-2 yes
/solve/set/equations uds-3 yes


;/define/custom-field-functions/list-valid-cell-function-names
/define/custom-field-functions/define "gw-pfhb_mg-per-dL" (uds_0_scalar/1035)^(.758)*11500
;/define/custom-field-functions/define "gw-from-zero-pfhb_mg-per-dL" (uds_2_scalar/1035)^(.758)*11500
/define/custom-field-functions/define "resolved-tke" .5*(rmse_x_velocity^2 + rmse_y_velocity^2 + rmse_z_velocity^2)
/define/custom-field-functions/define "mixed-modeled-tke" (viscosity_turb*turb_diss_rate*sbes_shielding_function/(density*0.09))^(1/2) + (viscosity_turb*(1-sbes_shielding_function)/(density*.325*(cell_volume^(1/3))))^(1/2)
/define/custom-field-functions/define "modeled_tke_rans" = (turb_diss_rate*viscosity_turb)
/define/custom-field-functions/define "percent_resolved_tke" resolved_tke/(resolved_tke+mixed_modeled_tke)



/surface/iso-surface raw-q-criterion q-crit () 2244 3002 () 1.5e6 ()
/display/objects/create contour vel_qcrit surfaces-list q-crit () field velocity-magnitude color-map color "bgr" length 1.2 width 6 position 0 () ()

/display/objects/create contour velmag_bp surfaces-list blade-passage () field velocity-magnitude color-map color "bgr" position 0 length 1.2 width 6 () ()
/display/objects/create contour pressure_bp surfaces-list blade-passage () field pressure color-map color "bgr" position 0 length 1.2 width 6 () ()
/display/objects/create contour pfhb surfaces-list blade-passage () field gw-pfhb_mg-per-dl range-option auto-range-off clip-to-range? no maximum 70 minimum 1 () color-map color "bgr" log-scale? yes length 1.2 width 6 position 0 () ()
;/display/objects/create contour pfhb_init surfaces-list blade-passage () field gw-from-zero-pfhb_mg-per-dL range-option auto-range-off clip-to-range? no maximum 70 minimum 1 () color-map color "bgr" log-scale? yes  position 0 length 1.2 width 6 position 0 () ()

/display/set/picture/driver png
/display/set/picture/landscape yes
/display/set/picture/use-window-resolution? no
/display/set/picture/x-resolution 3840
/display/set/picture/y-resolution 2160

/display/objects/display velmag_bp
/views/restore-view front
/views/auto-scale
/display/views/camera/zoom-camera 2
/display/views/camera/dolly-camera 0.15 0 0
/views/save-view bp-contour

;###### Display and save first image
/display/save-picture velmag-%t.png
/display/objects/display pressure_bp
/display/save-picture pressure_bp-%t.png
/display/objects/display pfhb
/display/save-picture pfhb-%t.png
/display/objects/display pfhb_init
/display/save-picture pfhb_init-%t.png

/display/objects/display vel_qcrit
/views/restore-view front
/views/auto-scale
/views/camera orbit-camera -5 -15
/views/auto-scale
/views/camera orbit-camera -2.5 -0
/views/auto-scale
/views/save-view qcrit-contour
/display/save-picture vel_qcrit-%t.png

/solve/execute-commands/add-edit contour-disp 20 "time-step" "/views/restore-view bp-contour-2"
/solve/execute-commands/add-edit show-velo 20 "time-step" "/display/objects/display velmag_bp"
/solve/execute-commands/add-edit velo-save 20 "time-step" "/display/save-picture velmag-%t.png"

/solve/execute-commands/add-edit show-pres 20 "time-step" "/display/objects/display pressure_bp"
/solve/execute-commands/add-edit pres-save 20 "time-step" "/display/save-picture pressure_bp-%t.png"

/solve/execute-commands/add-edit show-hemo 20 "time-step" "/display/objects/display pfhb"
/solve/execute-commands/add-edit hemo-save 20 "time-step" "/display/save-picture pfhb-%t.png"


/solve/execute-commands/add-edit proc-stats 4 "qcrit-contour" "/views/restore-view qcrit-contour"
/solve/execute-commands/add-edit proc-stats 4 "disp-vel_qcrit" "/display/objects/display vel_qcrit"
/solve/execute-commands/add-edit usage-stats 4 "save-qcrit" "/display/save-picture vel_qcrit-%t.png"

/solve/dual-time-iterate 1600 120;[max timesteps, iterations per step]



/define/custom-field-functions/define "gw-pfhb_mg-per-dL" (uds_0_scalar/1035)^(.758)*11500
/define/custom-field-functions/define "turb-diss-rate-rans" turb_diss_rate*sbes_shielding_function
/define/custom-field-functions/define "turb-diss-rate-sgs-fluent" turb_diss_rate*(1-sbes_shielding_function)
/define/custom-field-functions/define "turb-diss-rate-sgs-cff" viscosity_turb/density*(strain_rate_mag^2)*(1-sbes_shielding_function)
/define/custom-field-functions/define "turb-diss-rate-resolved" 0.0035/density*(strain_rate_mag^2)*(1-sbes_shielding_function)
/define/custom-field-functions/define "total-turb-diss-rate-fluent" turb_diss_rate_rans + turb_diss_rate_sgs_fluent + turb_diss_rate_resolved
/define/custom-field-functions/define "total-turb-diss-rate-cff" turb_diss_rate_rans + turb_diss_rate_sgs_cff + turb_diss_rate_resolved
;/define/custom-field-functions/define "kolmogorov-length-scale" (((0.0035/density)^3)/total_turb_diss_rate_fluent)^(.25)

/solve/set/data-sampling yes 1600 yes yes no



/define/custom-field-functions/define "tke-rans" turb_kinetic_energy*sbes_shielding_function
/define/custom-field-functions/define "tke-sgs" turb_kinetic_energy*(1-sbes_shielding_function)
/define/custom-field-functions/define "resolved-tke" .5*(rmse_x_velocity^2 + rmse_y_velocity^2 + rmse_z_velocity^2)*(1-sbes_shielding_function)
/define/custom-field-functions/define "tke-total" tke_rans + resolved_tke + tke_sgs
/solve/set/data-sampling-options add-datasets rotor_geometry volute () turb-diss-rate turb-kinetic-energy uds-0-scalar uds-1-scalar viscosity-turb sbes-shielding-function strain-rate-mag ()
/solve/set/data-sampling yes 1600 yes yes yes no no no no yes yes yes yes yes yes yes yes yes yes

/file/transient-export tecplot C4-SBES blade-passage () cell-volume dx-velocity-dx dx-velocity-dy dx-velocity-dz dy-velocity-dx dy-velocity-dy dy-velocity-dz dz-velocity-dx dz-velocity-dy dz-velocity-dz sbes-shielding-function turb-kinetic-energy viscosity-turb velocity-magnitude x-velocity y-velocity z-velocity turb-diss-rate turb-diss-rate-sgs-fluent turb-diss-rate-sgs-cff turb-diss-rate-resolved turb-diss-rate-rans strain-rate-mag () "C4-SBES" "time-step" 400 time-step
/file/export tecplot C4-SBES-08000 blade-passage () cell-volume dx-velocity-dx dx-velocity-dy dx-velocity-dz dy-velocity-dx dy-velocity-dy dy-velocity-dz dz-velocity-dx dz-velocity-dy dz-velocity-dz sbes-shielding-function turb-kinetic-energy viscosity-turb velocity-magnitude x-velocity y-velocity z-velocity turb-diss-rate turb-diss-rate-sgs-fluent turb-diss-rate-sgs-cff turb-diss-rate-resolved turb-diss-rate-rans strain-rate-mag ()


;##########  Energy Dissipation Scalars ##########;

/define/user-defined/user-defined-scalars 6 no no yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default"

/define/named-expressions/add resolved_dissipation_sbes definition "(1-ShieldingFunctionforSBESorSDES)*(StrainRate)^2*(0.035[kg/(m s)])/Density" description "Resolved dissipation portion of Turbulent Energy Dissipation" ()
/define/named-expressions/add total_dissipation definition "resolved_dissipation_sbes + TurbulenceDissipationRate" ()

/define/named-expressions/add EDS_GW definition "1035*(3.62E-7*(Density*total_dissipation*0.0035[Pa s]/1[Pa^2])^(2.416/2))^(1/0.785)" ()
/define/named-expressions/add EDS_HO definition "1035*(1.8E-8*(Density*total_dissipation*0.0035[Pa s]/1[Pa^2])^(1.991/2))^(1/0.765)" ()
/define/named-expressions/add EDS_TZ definition "1035*(1.228E-7*(Density*total_dissipation*0.0035[Pa s]/1[Pa^2])^(1.9918/2))^(1/0.6606)" ()
/define/named-expressions/add EDB definition "1035*(1.467E-2*(total_dissipation*1E-7[s^3/m^2]))^(2.2)" ()

;########## Change within cell zones and difusion w/in diffusivity

/solve/report-definitions/add EDS_GW surface-massavg surface-names outlet () field uds-2-scalar ()
/solve/report-definitions/add EDS_HO surface-massavg surface-names outlet () field uds-3-scalar ()
/solve/report-definitions/add EDS_TZ surface-massavg surface-names outlet () field uds-4-scalar ()
/solve/report-definitions/add EDB surface-massavg surface-names outlet () field uds-5-scalar ()

/solve/report-files/add/EDS_GW active yes frequency 1 print yes report-defs EDS_GW  () file-name EDS_GW  ()
/solve/report-files/add/EDS_HO active yes frequency 1 print yes report-defs EDS_HO () file-name EDS_HO ()
/solve/report-files/add/EDS_TZ active yes frequency 1 print yes report-defs EDS_TZ () file-name EDS_TZ ()
/solve/report-files/add/EDB active yes frequency 1 print yes report-defs EDB () file-name EDB ()

/define/materials/change-create air blood yes constant 1035 no no yes constant 0.0035 no no yes defined-per-uds 0 constant 0 1 constant 0 -1 no yes

/solve/execute-command disable contour-disp
/solve/execute-command disable show-velo
/solve/execute-command disable velo-save
/solve/execute-command disable show-pres
/solve/execute-command disable pres-save
/solve/execute-command disable show-hemo
/solve/execute-command disable hemo-save

/define/materials/change-create blood blood no no no no no no yes defined-per-uds 0 constant 0 1 constant 0 2 constant 0 3 constant 0 4 constant 0 5 constant 0 -1 no

/define/boundary-conditions/fluid volute no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 yes "EDS_GW" 1 yes "EDS_HO" 1 yes "EDS_TZ" 1 yes "EDB" no no no 0 no 0 no 0 no 0 no 0 no 0 no 1 no no no no no
/define/boundary-conditions/fluid rotor_geometry no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 yes "EDS_GW" 1 yes "EDS_HO" 1 yes "EDS_TZ" 1 yes "EDB" no yes -1 no "rotor_speed" no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 1 "none" no no no no no no

/solve/set/discretization-scheme/uds-2 1
/solve/set/discretization-scheme/uds-3 1
/solve/set/discretization-scheme/uds-4 1
/solve/set/discretization-scheme/uds-5 1



;### add to tecplot exports
;### add to data sampling
;#second order upwind
;### URF to 0.9 all uds


exit