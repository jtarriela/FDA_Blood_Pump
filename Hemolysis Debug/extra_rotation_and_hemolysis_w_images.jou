/file/read-case-data "C5_SBES_19M_T-1-24000.cas.h5"


;########## Compile new udf with extra uds CY_Hemolysis_MOD_UDF.c
/define/user-defined/compiled-functions compile libudf yes "CY_Hemolysis_MOD_UDF.c" "" "udf.h" ""
/define/user-defined/compiled-functions load libudf
/define/user-defined/function-hooks/adjust "BloodDamage::libudf" ""
/define/user-defined/user-defined-scalars 4 no no yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default" yes "mass flow rate" "default"
/define/materials/change-create blood blood no no no no no no yes defined-per-uds 0 constant 0 1 constant 0 2 constant 0 3 constant 0 -1 no
;##########   Cell Zone Def Rotor Rotation & Source Terms ##########;
/define/boundary-conditions/fluid inflow no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no no no 0 no 0 no 0 no 0 no 0 no 0 no 1 no no no no no
/define/boundary-conditions/fluid rotor no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no yes -1 no "rotor_speed" no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 0 no 1 "none" no no no no no
/define/boundary-conditions/fluid volute no yes 0 0 0 0 0 0 1 no yes "GW_model::libudf" 1 no yes "GW_HO::libudf" 1 no yes "GW_model_ss::libudf" 1 no yes "GW_HO_ss::libudf" no no no 0 no 0 no 0 no 0 no 0 no 0 no 0 no no no no no

;########### set new convergence

;########### flow equations

/solve/set/equations flow yes
/solve/set/equations kw yes
/solve/set/equations uds-0 yes
/solve/set/equations uds-1 yes
/solve/set/equations uds-2 yes
/solve/set/equations uds-3 yes


;/define/custom-field-functions/list-valid-cell-function-names
/define/custom-field-functions/define "gw-pfhb_mg-per-dL" (uds_0_scalar/1035)^(.758)*11500
/define/custom-field-functions/define "gw-from-zero-pfhb_mg-per-dL" (uds_2_scalar/1035)^(.758)*11500
/define/custom-field-functions/define "resolved-tke" .5*(rmse_x_velocity^2 + rmse_y_velocity^2 + rmse_z_velocity^2)
/define/custom-field-functions/define "mixed-modeled-tke" (viscosity_turb*turb_diss_rate*sbes_shielding_function/(density*0.09))^(1/2) + (viscosity_turb*(1-sbes_shielding_function)/(density*.325*(cell_volume^(1/3))))^(1/2)
/define/custom-field-functions/define "percent_resolved_tke" resolved_tke/(resolved_tke+mixed_modeled_tke)


/define/custom-field-functions/define "rans_tke" turb_kinetic_energy*sbes_shielding_function
/define/custom-field-functions/define "sgs_tke" (viscosity_turb*(1-sbes_shielding_function)/(density*0.325*cell_volume^(1/3)))^2
/define/custom-field-functions/define "total_modeled_tke" rans_tke+sgs_tke
/define/custom-field-functions/define "resolved-tke" .5*(rmse_x_velocity^2 + rmse_y_velocity^2 + rmse_z_velocity^2)
/define/custom-field-functions/define "percent_resolved_tke" resolved_tke/(resolved_tke+total_modeled_tke)



/surface/iso-surface raw-q-criterion q-crit () 2244 3002 () 1.5e6 ()
/display/objects/create contour vel_qcrit surfaces-list q-crit () field velocity-magnitude color-map color "bgr" length 1.2 width 6 position 0 () ()

/display/objects/create contour velmag_bp surfaces-list blade-passage () field velocity-magnitude color-map color "bgr" position 0 length 1.2 width 6 () ()
/display/objects/create contour pressure_bp surfaces-list blade-passage () field pressure color-map color "bgr" position 0 length 1.2 width 6 () ()
/display/objects/create contour pfhb surfaces-list blade-passage () field gw-pfhb_mg-per-dl range-option auto-range-off clip-to-range? no maximum 70 minimum 1 () color-map color "bgr" log-scale? yes length 1.2 width 6 position 0 () ()
/display/objects/create contour pfhb_init surfaces-list blade-passage () field gw-from-zero-pfhb_mg-per-dL range-option auto-range-off clip-to-range? no maximum 70 minimum 1 () color-map color "bgr" log-scale? yes  position 0 length 1.2 width 6 position 0 () ()

/display/set/picture/driver png
/display/set/picture/landscape yes
/display/set/picture/use-window-resolution? no
/display/set/picture/x-resolution 3840
/display/set/picture/y-resolution 2160

/display/objects/display velmag_bp
/views/restore-view front
/views/auto-scale
/display/views/camera/zoom-camera 4
/display/views/camera/dolly-camera 0.15 0 0
/views/save-view bp-contour

;###### Display and save first image
/display/save-picture velmag-%t.png
/display/objects/display pressure_bp
/display/save-picture pressure_bp-%t.png
/display/objects/display pfhb
/display/save-picture pfhb-%t.png
/display/objects/display pfhb_init
/display/save-picture pfhb_init-%t.png

/display/objects/display vel_qcrit
/views/restore-view front
/views/auto-scale
/views/camera orbit-camera -5 -15
/views/auto-scale
/views/camera orbit-camera -2.5 -0
/views/auto-scale
/views/save-view qcrit-contour
/display/save-picture vel_qcrit-%t.png


/solve/execute-commands/add-edit proc-stats 4 "bp-disp" "/views/restore-view bp-contour"
/solve/execute-commands/add-edit partition-info 4 "disp-velmagbp" "/display/objects/display velmag_bp"
/solve/execute-commands/add-edit usage-stats 4 "save-velmagbp" "/display/save-picture velmag-%t.png"

/solve/execute-commands/add-edit proc-stats 4 "disp-pressure_bp" "/display/objects/display pressure_bp"
/solve/execute-commands/add-edit usage-stats 4 "save-pressure-bp" "/display/save-picture pressure_bp-%t.png"

/solve/execute-commands/add-edit proc-stats 4 "disp-pfhb" "/display/objects/display pfhb"
/solve/execute-commands/add-edit usage-stats 4 "save-pfhb" "/display/save-picture pfhb-%t.png"

/solve/execute-commands/add-edit proc-stats 4 "disp-pfhb_init" "/display/objects/display pfhb_init"
/solve/execute-commands/add-edit usage-stats 4 "save-pfhb_init" "/display/save-picture pfhb_init-%t.png"

/solve/execute-commands/add-edit proc-stats 4 "qcrit-contour" "/views/restore-view qcrit-contour"
/solve/execute-commands/add-edit proc-stats 4 "disp-vel_qcrit" "/display/objects/display vel_qcrit"
/solve/execute-commands/add-edit usage-stats 4 "save-qcrit" "/display/save-picture vel_qcrit-%t.png"

/solve/dual-time-iterate 1600 120;[max timesteps, iterations per step]


exit